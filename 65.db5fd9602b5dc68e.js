"use strict";(self.webpackChunkordersystem=self.webpackChunkordersystem||[]).push([[65],{9065:(Y,u,c)=>{c.r(u),c.d(u,{PayModule:()=>X});var h=c(177),e=c(7705),f=c(1359),b=c(8490),y=c(7038),m=c(6600),g=c(3152);function v(r,p){1&r&&(e.j41(0,"span",5),e.EFF(1,"Keine offenen Tische"),e.k0s())}function _(r,p){if(1&r&&(e.j41(0,"span",6),e.EFF(1),e.k0s()),2&r){const t=p.$implicit;e.Mz_("routerLink","/pay/cart/",t.nr,""),e.R7$(1),e.JRh(t.nr)}}let O=(()=>{class r{constructor(t,n,a){this.header=t,this.data=n,this.loading=a,this.openTables=null,this.data.fetchData(),this.loading.activateLoading()}ngOnInit(){setTimeout(()=>this.header.text="Bezahlen");let t=[];this.data.tables.subscribe(n=>t=n),this.data.orderedItems.subscribe(n=>{this.openTables=n.filter(a=>!a.paid).map(a=>isNaN(Number(a.table))?a.table:t.find(s=>s.id===Number(a.table))).filter((a,s,i)=>a&&i.findIndex(o=>o&&o.id===a.id)===s)||null,this.loading.deactivateLoading()}),this.data.fetchData()}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(f.d),e.rXU(b.u),e.rXU(y.U))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-pay-tables"]],decls:7,vars:2,consts:[["id","table-wrapper"],["routerLink","/pay/cart",1,"table","wide"],["id","category-header"],["class","error",4,"ngIf"],["class","table","matRipple","",3,"routerLink",4,"ngFor","ngForOf"],[1,"error"],["matRipple","",1,"table",3,"routerLink"]],template:function(n,a){1&n&&(e.j41(0,"div",0)(1,"span",1),e.EFF(2,"ohne Tisch kassieren"),e.k0s(),e.j41(3,"p",2),e.EFF(4,"offene Tische"),e.k0s(),e.DNE(5,v,2,0,"span",3),e.DNE(6,_,2,2,"span",4),e.k0s()),2&n&&(e.R7$(5),e.Y8G("ngIf",0===(null==a.openTables?null:a.openTables.length)),e.R7$(1),e.Y8G("ngForOf",a.openTables))},dependencies:[h.Sq,h.bT,m.r6,g.Wk],styles:["[_nghost-%COMP%]{width:100%;display:flex;padding-bottom:20%;justify-content:center}#table-wrapper[_ngcontent-%COMP%]{width:88%;display:flex;flex-wrap:wrap;align-items:flex-start}#table-wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{width:20vw;height:20vw;margin:1vw;display:flex;justify-content:center;align-items:center;background:#dbdbdb;cursor:pointer;border-radius:15px;transition:.2s ease-in-out background;-webkit-user-select:none;user-select:none;outline:none;font-size:8vw;font-weight:500}#table-wrapper[_ngcontent-%COMP%]   .table.wide[_ngcontent-%COMP%]{width:100%;font-size:5vw;height:15vw}#table-wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]:hover{background:rgba(252,207,137,.68)}#table-wrapper[_ngcontent-%COMP%]   #category-header[_ngcontent-%COMP%]{width:100%;outline:none;font-size:4vw;font-weight:500}"]})}}return r})();var M=c(467),C=c(5416),T=c(4449),l=c(9417);function I(r,p){1&r&&(e.j41(0,"span",12),e.EFF(1,"offene Positionen"),e.k0s())}function w(r,p){1&r&&(e.j41(0,"span",13),e.EFF(1,"Keine offenen Positionen"),e.k0s())}function F(r,p){1&r&&(e.j41(0,"span",14),e.EFF(1,"Alle Produkte"),e.k0s())}const k=function(){return[]};function E(r,p){if(1&r){const t=e.RV6();e.j41(0,"app-order-category",15),e.bIt("itemsChange",function(a){const i=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.itemsChange(i.id,a))}),e.k0s()}if(2&r){const t=p.$implicit,n=e.XpG();e.Y8G("items",n.products.get(t.id)||e.lJ4(2,k))("title",t.name)}}function N(r,p){if(1&r&&(e.j41(0,"div",16)(1,"span"),e.EFF(2),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&r){const t=p.$implicit,n=e.XpG();e.R7$(2),e.Lme("",t.amount," x ",t.name,""),e.R7$(2),e.SpI("",n.formatPrice((t.amount||0)*t.price),"\u20ac")}}function R(r,p){1&r&&(e.j41(0,"span",13),e.EFF(1,"Der Warenkorb ist leer"),e.k0s())}function x(r,p){if(1&r&&(e.j41(0,"span",17),e.EFF(1),e.k0s()),2&r){const t=e.XpG();e.R7$(1),e.SpI("Summe: ",t.formatPrice(t.getTotalPrice()),"\u20ac")}}let P=(()=>{class r{constructor(t,n,a,s){this.header=t,this.data=n,this.route=a,this.snackBar=s,this.selectedTableNr=this.route.snapshot.paramMap.get("tableNr"),this.header.text=this.selectedTableNr?`Tisch ${this.selectedTableNr} kassieren`:"Kassieren",this.products=new Map,this.categories=[],this.openItems=[],this.tables=[],this.selectedOpenProducts=[],this.returnAmount=0,this.amountReceived=NaN,this.data.categories.subscribe(i=>{this.categories=i.sort((o,d)=>o.ordering-d.ordering),this.categories.forEach(o=>{this.products.has(o.id)||this.products.set(o.id,[])})}),this.data.tables.subscribe(i=>this.tables=i),this.data.products.subscribe(i=>{this.products.clear(),i.sort((o,d)=>o.ordering-d.ordering).forEach(o=>{o.amount=0,this.products.has(o.category.id)?this.products.get(o.category.id).push(o):this.products.set(o.category.id,[o])})}),this.selectedTableNr&&(this.data.fetchData(),this.data.orderedItems.subscribe(i=>{this.openItems=[],i.filter(o=>isNaN(Number(o.table))&&o.table.nr===this.selectedTableNr&&!o.paid).forEach(o=>{const d=this.openItems.findIndex(A=>A.id===o.item.id);-1===d?this.openItems.push({id:o.item.id,dbIds:[o.id],amount:1,category:o.item.category,ordering:o.item.ordering,name:o.item.name,paid:o.paid,price:o.item.price}):(this.openItems[d].dbIds.push(o.id),this.openItems[d].amount+=1)}),this.openItems.sort((o,d)=>o.ordering-d.ordering)})),this.data.fetchData()}formatPrice(t){return t.toString().replace(".",",")}reset(){this.products.forEach(t=>t.forEach(n=>n.amount=0)),this.selectedOpenProducts=[],this.openItems.forEach(t=>t.amount=t.dbIds.length),document.getElementsByClassName("page-container")[0].scrollTop=0}complete(){var t=this;return(0,M.A)(function*(){const n=[],a=t.tables.find(s=>s.nr===t.selectedTableNr)?.id||null;t.products.forEach(s=>{s.filter(i=>(i.amount||0)>0).forEach(i=>{const o={id:-1,table:a,item:i.id,paid:!0};for(let d=0;d<(i.amount||0);d++)n.push(t.data.upsert("ordered_product",o))})}),t.selectedOpenProducts.forEach(s=>{const i=s.dbIds.length-(s.amount||0);for(let o=0;o<i;o++){const d=s.dbIds.shift();d&&n.push(t.data.upsert("ordered_product",{id:d,table:a,item:s.id,paid:!0}))}}),Promise.all(n).then(()=>{t.snackBar.open("Kassiervorgang erfolgreich.","X",{duration:2500}),t.reset()}).catch(s=>{console.log(s),t.snackBar.open("Kassiervorgang fehlgeschlagen.","X",{duration:2500})})})()}getCategoriesWithProducts(){return this.categories.filter(t=>(this.products.get(t.id)?.length||0)>0)}getSelectedProducts(){const t=[];return this.products.forEach(n=>{t.push(...n.filter(a=>(a.amount||0)>0))}),this.selectedOpenProducts.forEach(n=>{n.dbIds.length!==n.amount&&t.push({...n,amount:n.dbIds.length-(n.amount||0)})}),t.sort((n,a)=>n.category.ordering-a.category.ordering)}getTotalPrice(){let t=0;return this.products.forEach(n=>{t+=n.reduce((a,s)=>a+s.price*(s.amount||0),0)}),this.selectedOpenProducts.forEach(n=>{t+=n.price*(n.dbIds.length-(n.amount||0))}),t}openItemsChange(t){this.selectedOpenProducts=t}amountReceivedChanged(){this.returnAmount=(this.amountReceived||0)-this.getTotalPrice()}itemsChange(t,n){this.products.set(t,n),this.amountReceivedChanged()}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(f.d),e.rXU(b.u),e.rXU(g.nX),e.rXU(C.UG))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-pay"]],decls:18,vars:11,consts:[["id","open-items-header",4,"ngIf"],["title","",3,"flipAmountAction","items","itemsChange"],["class","error",4,"ngIf"],["id","all-items-header",4,"ngIf"],[3,"items","title","itemsChange",4,"ngFor","ngForOf"],["id","cart-wrapper"],["class","item",4,"ngFor","ngForOf"],["id","sum",4,"ngIf"],["min","0","placeholder","Betrag erhalten","type","number",3,"ngModel","input","ngModelChange"],["id","return"],["matRipple","",1,"button","btn-ok",3,"click"],["matRipple","",1,"button","btn-danger",3,"click"],["id","open-items-header"],[1,"error"],["id","all-items-header"],[3,"items","title","itemsChange"],[1,"item"],["id","sum"]],template:function(n,a){1&n&&(e.DNE(0,I,2,0,"span",0),e.j41(1,"app-order-category",1),e.bIt("itemsChange",function(i){return a.openItemsChange(i)}),e.k0s(),e.DNE(2,w,2,0,"span",2),e.DNE(3,F,2,0,"span",3),e.DNE(4,E,1,3,"app-order-category",4),e.j41(5,"div",5)(6,"h2"),e.EFF(7,"Warenkorb"),e.k0s(),e.DNE(8,N,5,3,"div",6),e.DNE(9,R,2,0,"span",2),e.DNE(10,x,2,1,"span",7),e.j41(11,"input",8),e.bIt("input",function(){return a.amountReceivedChanged()})("ngModelChange",function(i){return a.amountReceived=i}),e.k0s(),e.j41(12,"span",9),e.EFF(13),e.k0s(),e.j41(14,"button",10),e.bIt("click",function(){return a.complete()}),e.EFF(15,"Bezahlvorgang abschlie\xdfen "),e.k0s(),e.j41(16,"button",11),e.bIt("click",function(){return a.reset()}),e.EFF(17,"Zur\xfccksetzen"),e.k0s()()),2&n&&(e.Y8G("ngIf",a.selectedTableNr),e.R7$(1),e.Y8G("flipAmountAction",!0)("items",a.openItems),e.R7$(1),e.Y8G("ngIf",a.selectedTableNr&&0===a.openItems.length),e.R7$(1),e.Y8G("ngIf",a.selectedTableNr),e.R7$(1),e.Y8G("ngForOf",a.getCategoriesWithProducts()),e.R7$(4),e.Y8G("ngForOf",a.getSelectedProducts()),e.R7$(1),e.Y8G("ngIf",0===a.getSelectedProducts().length),e.R7$(1),e.Y8G("ngIf",a.getTotalPrice()>0),e.R7$(1),e.Y8G("ngModel",a.amountReceived),e.R7$(2),e.SpI("R\xfcckgeld: ",a.formatPrice(a.returnAmount),"\u20ac"))},dependencies:[h.Sq,h.bT,m.r6,T.A,l.me,l.Q0,l.BC,l.VZ,l.vS],styles:["#cart-wrapper[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:0 20% 20%}#cart-wrapper[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}#cart-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin-top:3vh}#cart-wrapper[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{display:block;text-align:center}#cart-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between}#cart-wrapper[_ngcontent-%COMP%]   #sum[_ngcontent-%COMP%]{margin-top:.5em;font-weight:500;border-top:1px solid;width:100%;display:block;padding-top:.25em}#open-items-header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:flex-start;padding:5px 10px;background:var(--danger);color:#fff}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;font-size:4vw;padding:10px 0}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:nth-child(2n){background:var(--table-accent)}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{width:15%;text-align:center}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:60%}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{width:25%}#all-items-header[_ngcontent-%COMP%]{width:100%;margin-top:3vh;display:flex;align-items:center;justify-content:flex-start;padding:5px 10px;background:var(--light);color:#fff}input[_ngcontent-%COMP%]{width:100%;padding:.65em;box-shadow:var(--box-shadow);background:transparent;box-sizing:border-box;outline:none;border:none;margin:1em 0;border-bottom:2px solid lightgray;border-radius:5px;transition:border-color .3s ease-in-out}input[_ngcontent-%COMP%]:focus{border-color:var(--primary)}"]})}}return r})();var j=c(5553),$=c(9631),G=c(1801);const D=[{path:"open-tables",component:O},{path:"cart/:tableNr",component:P},{path:"cart",component:P},{path:"",redirectTo:"open-tables",pathMatch:"full"}];let X=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[h.MD,m.pZ,g.iI.forChild(D),j.h,$.fS,G.m_,C._T,l.X1,l.YN]})}}return r})()}}]);