"use strict";(self.webpackChunkordersystem=self.webpackChunkordersystem||[]).push([[635],{8490:(D,v,n)=>{n.d(v,{u:()=>T});var f=n(467),t=n(4412),g=n(8203),y=n(7705);let T=(()=>{class d{constructor(){this.tables=new t.t([]),this.categories=new t.t([]),this.products=new t.t([]),this.orderedItems=new t.t([]),this.devices=new t.t([]),this.infrastructure=new t.t([]),this.initTableData("ordered_product",this.orderedItems,"*, table:table(*), item:product(*)"),this.initTableData("product",this.products,"*, category:category(*)"),this.initTableData("category",this.categories),this.initTableData("tables",this.tables),this.initTableData("device",this.devices),this.initTableData("infrastructure",this.infrastructure,"*, printer:device(*)"),this.fetchData()}fetchData(){this.tables.next(this.tables.value),this.products.next(this.products.value),this.categories.next(this.categories.value),this.orderedItems.next(this.orderedItems.value),this.devices.next(this.devices.value),this.infrastructure.next(this.infrastructure.value)}upsert(o,s){return-1===s.id&&delete s.id,new Promise(u=>{g.N.from(o).upsert([s]).then(i=>{u(i)})})}delete(o,s){return new Promise(function(){var u=(0,f.A)(function*(i,p){const{data:e,error:c}=yield g.N.from(o).delete().eq("id",s);c?p(c):i(e)});return function(i,p){return u.apply(this,arguments)}}())}createOrder(o){return new Promise((s,u)=>{g.N.from("orders").insert([o]).then(i=>{i.error?(console.error(i.error),u(i.error)):s(i)})})}initTableData(o,s,u="*"){var i=this;return(0,f.A)(function*(){const{data:p,error:e}=yield g.N.from(o).select(u);e?console.log(e.message):s.next(p),g.N.channel(`realtime-${o}`).on("postgres_changes",{event:"*",schema:"public",table:o},c=>{console.log("Realtime Change:",c);const r=s.getValue();switch(c.eventType){case"INSERT":const a=c.new;if(a.category&&!isNaN(Number(a.category))){const l=Number(a.category);a.category=i.categories.getValue().find(m=>m.id===l)||{id:l}}r.push(a),s.next(r);break;case"UPDATE":const h=r.findIndex(l=>l.id===c.old.id),b=c.new;if(b.category&&!isNaN(Number(b.category))){const l=Number(b.category);b.category=i.categories.getValue().find(m=>m.id===l)||{id:l}}-1!==h&&(r[h]=b,s.next(r));break;case"DELETE":s.next(r.filter(l=>l.id!==c.old.id))}}).subscribe()})()}static{this.\u0275fac=function(s){return new(s||d)}}static{this.\u0275prov=y.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},4635:(D,v,n)=>{n.r(v),n.d(v,{TablesModule:()=>p});var f=n(177),t=n(7705),g=n(1359),y=n(8490),T=n(7038),d=n(3152),w=n(6600);function o(e,c){1&e&&(t.j41(0,"span",3),t.EFF(1,"Keine Tische gefunden"),t.k0s())}function s(e,c){if(1&e&&(t.j41(0,"span",4),t.EFF(1),t.k0s()),2&e){const r=c.$implicit;t.Mz_("routerLink","/order/",r.nr,""),t.R7$(1),t.JRh(r.nr)}}const i=[{path:"",component:(()=>{class e{constructor(r,a,h,b){this.header=r,this.data=a,this.loading=h,this.router=b,this.subscriptions=[],this.tables=null,this.header.text="Tischauswahl",this.data.fetchData(),this.loading.activateLoading();const l=this.data.tables.subscribe(m=>{this.tables=m.sort((E,x)=>E.ordering-x.ordering),this.loading.deactivateLoading(),this.router.navigateByUrl("/",{skipLocationChange:!0}).then(()=>{})});this.subscriptions.push(l)}ngOnDestroy(){this.subscriptions.forEach(r=>r.unsubscribe())}static{this.\u0275fac=function(a){return new(a||e)(t.rXU(g.d),t.rXU(y.u),t.rXU(T.U),t.rXU(d.Ix))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-tables"]],decls:3,vars:2,consts:[["id","table-wrapper"],["class","error",4,"ngIf"],["class","table","matRipple","",3,"routerLink",4,"ngFor","ngForOf"],[1,"error"],["matRipple","",1,"table",3,"routerLink"]],template:function(a,h){1&a&&(t.j41(0,"div",0),t.DNE(1,o,2,0,"span",1),t.DNE(2,s,2,2,"span",2),t.k0s()),2&a&&(t.R7$(1),t.Y8G("ngIf",0===(null==h.tables?null:h.tables.length)),t.R7$(1),t.Y8G("ngForOf",h.tables))},dependencies:[f.Sq,f.bT,d.Wk,w.r6],styles:["[_nghost-%COMP%]{width:100%;display:flex;padding-bottom:20%;justify-content:center}#table-wrapper[_ngcontent-%COMP%]{width:88%;display:flex;flex-wrap:wrap;align-items:flex-start}#table-wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{width:20vw;height:20vw;margin:1vw;display:flex;justify-content:center;align-items:center;background:#dbdbdb;cursor:pointer;border-radius:15px;transition:.2s ease-in-out background;-webkit-user-select:none;user-select:none;outline:none;font-size:8vw;font-weight:500}#table-wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]:hover{background:rgba(252,207,137,.68)}"]})}}return e})()}];let p=(()=>{class e{static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[f.MD,d.iI.forChild(i),w.pZ]})}}return e})()}}]);