"use strict";(self.webpackChunkordersystem=self.webpackChunkordersystem||[]).push([[65],{9065:(Y,g,c)=>{c.r(g),c.d(g,{PayModule:()=>X});var l=c(177),t=c(7705),u=c(1359),f=c(8490),C=c(7038),h=c(6600),m=c(3152);function y(r,p){1&r&&(t.j41(0,"span",5),t.EFF(1,"Keine offenen Tische"),t.k0s())}function O(r,p){if(1&r&&(t.j41(0,"span",6),t.EFF(1),t.k0s()),2&r){const e=p.$implicit;t.Mz_("routerLink","/pay/cart/",e.nr,""),t.R7$(1),t.JRh(e.nr)}}let T=(()=>{class r{constructor(e,n,s){this.header=e,this.data=n,this.loading=s,this.openTables=null,this.data.fetchData(),this.loading.activateLoading()}ngOnInit(){setTimeout(()=>this.header.text="Bezahlen");let e=[];this.data.tables.subscribe(n=>e=n),this.data.orderedItems.subscribe(n=>{this.openTables=n.filter(s=>!s.paid).map(s=>isNaN(Number(s.table))?s.table:e.find(o=>o.id===Number(s.table))).filter((s,o,i)=>s&&i.findIndex(a=>a&&a.id===s.id)===o)||null,this.loading.deactivateLoading()}),this.data.fetchData()}static{this.\u0275fac=function(n){return new(n||r)(t.rXU(u.d),t.rXU(f.u),t.rXU(C.U))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-pay-tables"]],decls:7,vars:2,consts:[["id","table-wrapper"],["routerLink","/pay/cart",1,"table","wide"],["id","category-header"],["class","error",4,"ngIf"],["class","table","matRipple","",3,"routerLink",4,"ngFor","ngForOf"],[1,"error"],["matRipple","",1,"table",3,"routerLink"]],template:function(n,s){1&n&&(t.j41(0,"div",0)(1,"span",1),t.EFF(2,"ohne Tisch kassieren"),t.k0s(),t.j41(3,"p",2),t.EFF(4,"offene Tische"),t.k0s(),t.DNE(5,y,2,0,"span",3),t.DNE(6,O,2,2,"span",4),t.k0s()),2&n&&(t.R7$(5),t.Y8G("ngIf",0===(null==s.openTables?null:s.openTables.length)),t.R7$(1),t.Y8G("ngForOf",s.openTables))},dependencies:[l.Sq,l.bT,h.r6,m.Wk],styles:["[_nghost-%COMP%]{width:100%;display:flex;padding-bottom:20%;justify-content:center}#table-wrapper[_ngcontent-%COMP%]{width:88%;display:flex;flex-wrap:wrap;align-items:flex-start}#table-wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{width:20vw;height:20vw;margin:1vw;display:flex;justify-content:center;align-items:center;background:#dbdbdb;cursor:pointer;border-radius:15px;transition:.2s ease-in-out background;-webkit-user-select:none;user-select:none;outline:none;font-size:8vw;font-weight:500}#table-wrapper[_ngcontent-%COMP%]   .table.wide[_ngcontent-%COMP%]{width:100%;font-size:5vw;height:15vw}#table-wrapper[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]:hover{background:rgba(252,207,137,.68)}#table-wrapper[_ngcontent-%COMP%]   #category-header[_ngcontent-%COMP%]{width:100%;outline:none;font-size:4vw;font-weight:500}"]})}}return r})();var I=c(467),b=c(5416),v=c(4449);function M(r,p){1&r&&(t.j41(0,"span",10),t.EFF(1,"offene Positionen"),t.k0s())}function w(r,p){1&r&&(t.j41(0,"span",11),t.EFF(1,"Keine offenen Positionen"),t.k0s())}function F(r,p){1&r&&(t.j41(0,"span",12),t.EFF(1,"Alle Produkte"),t.k0s())}const _=function(){return[]};function k(r,p){if(1&r){const e=t.RV6();t.j41(0,"app-order-category",13),t.bIt("itemsChange",function(s){const i=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.products.set(i.id,s))}),t.k0s()}if(2&r){const e=p.$implicit,n=t.XpG();t.Y8G("items",n.products.get(e.id)||t.lJ4(2,_))("title",e.name)}}function E(r,p){if(1&r&&(t.j41(0,"div",14)(1,"span"),t.EFF(2),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()),2&r){const e=p.$implicit,n=t.XpG();t.R7$(2),t.Lme("",e.amount," x ",e.name,""),t.R7$(2),t.SpI("",n.formatPrice((e.amount||0)*e.price),"\u20ac")}}function N(r,p){1&r&&(t.j41(0,"span",11),t.EFF(1,"Der Warenkorb ist leer"),t.k0s())}function x(r,p){if(1&r&&(t.j41(0,"span",15),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(1),t.SpI("Summe: ",e.formatPrice(e.getTotalPrice()),"\u20ac")}}let P=(()=>{class r{constructor(e,n,s,o){this.header=e,this.data=n,this.route=s,this.snackBar=o,this.selectedTableNr=this.route.snapshot.paramMap.get("tableNr"),this.header.text=this.selectedTableNr?`Tisch ${this.selectedTableNr} kassieren`:"Kassieren",this.products=new Map,this.categories=[],this.openItems=[],this.tables=[],this.selectedOpenProducts=[],this.data.categories.subscribe(i=>{this.categories=i.sort((a,d)=>a.ordering-d.ordering),this.categories.forEach(a=>{this.products.has(a.id)||this.products.set(a.id,[])})}),this.data.tables.subscribe(i=>this.tables=i),this.data.products.subscribe(i=>{this.products.clear(),i.sort((a,d)=>a.ordering-d.ordering).forEach(a=>{a.amount=0,this.products.has(a.category.id)?this.products.get(a.category.id).push(a):this.products.set(a.category.id,[a])})}),this.selectedTableNr&&(this.data.fetchData(),this.data.orderedItems.subscribe(i=>{this.openItems=[],i.filter(a=>isNaN(Number(a.table))&&a.table.nr===this.selectedTableNr&&!a.paid).forEach(a=>{const d=this.openItems.findIndex(U=>U.id===a.item.id);-1===d?this.openItems.push({id:a.item.id,dbIds:[a.id],amount:1,category:a.item.category,ordering:a.item.ordering,name:a.item.name,paid:a.paid,price:a.item.price}):(this.openItems[d].dbIds.push(a.id),this.openItems[d].amount+=1)}),this.openItems.sort((a,d)=>a.ordering-d.ordering)})),this.data.fetchData()}formatPrice(e){return e.toString().replace(".",",")}reset(){this.products.forEach(e=>e.forEach(n=>n.amount=0)),this.selectedOpenProducts=[],this.openItems.forEach(e=>e.amount=e.dbIds.length),document.getElementsByClassName("page-container")[0].scrollTop=0}complete(){var e=this;return(0,I.A)(function*(){const n=[],s=e.tables.find(o=>o.nr===e.selectedTableNr)?.id||null;e.products.forEach(o=>{o.filter(i=>(i.amount||0)>0).forEach(i=>{const a={id:-1,table:s,item:i.id,paid:!0};for(let d=0;d<(i.amount||0);d++)n.push(e.data.upsert("ordered_product",a))})}),e.selectedOpenProducts.forEach(o=>{const i=o.dbIds.length-(o.amount||0);for(let a=0;a<i;a++){const d=o.dbIds.shift();d&&n.push(e.data.upsert("ordered_product",{id:d,table:s,item:o.id,paid:!0}))}}),Promise.all(n).then(()=>{e.snackBar.open("Kassiervorgang erfolgreich.","X",{duration:2500}),e.reset()}).catch(o=>{console.log(o),e.snackBar.open("Kassiervorgang fehlgeschlagen.","X",{duration:2500})})})()}getCategoriesWithProducts(){return this.categories.filter(e=>(this.products.get(e.id)?.length||0)>0)}getSelectedProducts(){const e=[];return this.products.forEach(n=>{e.push(...n.filter(s=>(s.amount||0)>0))}),this.selectedOpenProducts.forEach(n=>{n.dbIds.length!==n.amount&&e.push({...n,amount:n.dbIds.length-(n.amount||0)})}),e.sort((n,s)=>n.category.ordering-s.category.ordering)}getTotalPrice(){let e=0;return this.products.forEach(n=>{e+=n.reduce((s,o)=>s+o.price*(o.amount||0),0)}),this.selectedOpenProducts.forEach(n=>{e+=n.price*(n.dbIds.length-(n.amount||0))}),e}openItemsChange(e){this.selectedOpenProducts=e}static{this.\u0275fac=function(n){return new(n||r)(t.rXU(u.d),t.rXU(f.u),t.rXU(m.nX),t.rXU(b.UG))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-pay"]],decls:15,vars:9,consts:[["id","open-items-header",4,"ngIf"],["title","",3,"flipAmountAction","items","itemsChange"],["class","error",4,"ngIf"],["id","all-items-header",4,"ngIf"],[3,"items","title","itemsChange",4,"ngFor","ngForOf"],["id","cart-wrapper"],["class","item",4,"ngFor","ngForOf"],["id","sum",4,"ngIf"],["matRipple","",1,"button","btn-ok",3,"click"],["matRipple","",1,"button","btn-danger",3,"click"],["id","open-items-header"],[1,"error"],["id","all-items-header"],[3,"items","title","itemsChange"],[1,"item"],["id","sum"]],template:function(n,s){1&n&&(t.DNE(0,M,2,0,"span",0),t.j41(1,"app-order-category",1),t.bIt("itemsChange",function(i){return s.openItemsChange(i)}),t.k0s(),t.DNE(2,w,2,0,"span",2),t.DNE(3,F,2,0,"span",3),t.DNE(4,k,1,3,"app-order-category",4),t.j41(5,"div",5)(6,"h2"),t.EFF(7,"Warenkorb"),t.k0s(),t.DNE(8,E,5,3,"div",6),t.DNE(9,N,2,0,"span",2),t.DNE(10,x,2,1,"span",7),t.j41(11,"button",8),t.bIt("click",function(){return s.complete()}),t.EFF(12,"Bezahlvorgang abschlie\xdfen "),t.k0s(),t.j41(13,"button",9),t.bIt("click",function(){return s.reset()}),t.EFF(14,"Zur\xfccksetzen"),t.k0s()()),2&n&&(t.Y8G("ngIf",s.selectedTableNr),t.R7$(1),t.Y8G("flipAmountAction",!0)("items",s.openItems),t.R7$(1),t.Y8G("ngIf",s.selectedTableNr&&0===s.openItems.length),t.R7$(1),t.Y8G("ngIf",s.selectedTableNr),t.R7$(1),t.Y8G("ngForOf",s.getCategoriesWithProducts()),t.R7$(4),t.Y8G("ngForOf",s.getSelectedProducts()),t.R7$(1),t.Y8G("ngIf",0===s.getSelectedProducts().length),t.R7$(1),t.Y8G("ngIf",s.getTotalPrice()>0))},dependencies:[l.Sq,l.bT,h.r6,v.A],styles:["#cart-wrapper[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:0 20% 20%}#cart-wrapper[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}#cart-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin-top:3vh}#cart-wrapper[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{display:block;text-align:center}#cart-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between}#cart-wrapper[_ngcontent-%COMP%]   #sum[_ngcontent-%COMP%]{margin-top:.5em;font-weight:500;border-top:1px solid;width:100%;display:block;padding-top:.25em}#open-items-header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:flex-start;padding:5px 10px;background:var(--danger);color:#fff}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;font-size:4vw;padding:10px 0}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:nth-child(2n){background:var(--table-accent)}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{width:15%;text-align:center}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:60%}#open-items-wrapper[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{width:25%}#all-items-header[_ngcontent-%COMP%]{width:100%;margin-top:3vh;display:flex;align-items:center;justify-content:flex-start;padding:5px 10px;background:var(--light);color:#fff}"]})}}return r})();var j=c(5553),R=c(9631),$=c(1801),G=c(9417);const D=[{path:"open-tables",component:T},{path:"cart/:tableNr",component:P},{path:"cart",component:P},{path:"",redirectTo:"open-tables",pathMatch:"full"}];let X=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=t.$C({type:r})}static{this.\u0275inj=t.G2t({imports:[l.MD,h.pZ,m.iI.forChild(D),j.h,R.fS,$.m_,b._T,G.X1]})}}return r})()}}]);