"use strict";(self.webpackChunkordersystem=self.webpackChunkordersystem||[]).push([[927],{6927:(j,p,n)=>{n.r(p),n.d(p,{OrderModule:()=>X});var g=n(177),t=n(7705),m=n(3152),v=n(8490),O=n(1359),f=n(5416),N=n(4796),C=n(6600),b=n(9631),h=n(9417),y=n(4449);const F=function(){return[]};function M(s,c){if(1&s){const e=t.RV6();t.j41(0,"app-order-category",7),t.bIt("itemsChange",function(o){const l=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.products.set(l.id,o))}),t.k0s()}if(2&s){const e=c.$implicit,r=t.XpG();t.Y8G("items",r.products.get(e.id)||t.lJ4(2,F))("title",e.name)}}function P(s,c){if(1&s&&(t.j41(0,"div",8)(1,"span"),t.EFF(2),t.k0s()()),2&s){const e=c.$implicit;t.R7$(2),t.Lme("",e.amount," x ",e.name,"")}}function E(s,c){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(1),t.SpI("Notiz: ",e.orderNotes,"")}}function S(s,c){1&s&&(t.j41(0,"span",9),t.EFF(1,"Der Warenkorb ist leer"),t.k0s())}let T=(()=>{class s{constructor(e,r,o,d,l){this.route=e,this.data=r,this.header=o,this.snackBar=d,this.auth=l,this.selectedTableNr=this.route.snapshot.params.tableNr,this.products=new Map,this.categories=[],this.tables=[],this.header.text=`Tisch ${this.selectedTableNr}`,this.data.categories.subscribe(i=>{this.categories=i.sort((a,u)=>a.ordering-u.ordering),this.categories.forEach(a=>{this.products.has(a.id)||this.products.set(a.id,[])})}),this.data.tables.subscribe(i=>{this.tables=i}),this.data.products.subscribe(i=>{this.products.clear(),i.sort((a,u)=>a.ordering-u.ordering).forEach(a=>{this.products.has(a.category.id)?this.products.get(a.category.id).push({...a,amount:0}):this.products.set(a.category.id,[{...a,amount:0}])})}),this.data.fetchData(),this.orderSent=!1}getOrderDetails(){const e=this.tables.find(r=>r.nr===this.selectedTableNr);return e?{products:this.getSelectedProducts().map(r=>({id:r.id,amount:r.amount})),table:e.id,waiter:this.auth.username,note:this.orderNotes||""}:null}order(){const e=this.getOrderDetails();console.log({order:e}),e&&(this.orderSent||(this.orderSent=!0,this.data.createOrder(e).then(r=>{this.products.forEach(o=>{o.forEach(d=>d.amount=0)}),this.orderNotes=void 0,this.orderSent=!1,document.getElementsByClassName("page-container")[0].scrollTop=0,this.snackBar.open("Bestellung erfolgreich aufgegeben.","X",{duration:2500})}).catch(r=>{this.snackBar.open("Es ist ein Fehler aufgetreten.","X",{duration:2500}),console.log(r),this.orderSent=!1})))}getCategoriesWithProducts(){return this.categories.filter(e=>(this.products.get(e.id)?.length||0)>0)}getSelectedProducts(){const e=[];return this.products.forEach(r=>{e.push(...r.filter(o=>(o.amount||0)>0))}),e.sort((r,o)=>r.category.ordering-o.category.ordering)}static{this.\u0275fac=function(r){return new(r||s)(t.rXU(m.nX),t.rXU(v.u),t.rXU(O.d),t.rXU(f.UG),t.rXU(N.u))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-order"]],decls:10,vars:7,consts:[[3,"items","title","itemsChange",4,"ngFor","ngForOf"],["matInput","","placeholder","Anmerkung/Notiz",3,"ngModel","ngModelChange"],["id","cart-wrapper"],["class","item",4,"ngFor","ngForOf"],[4,"ngIf"],["class","error",4,"ngIf"],["matRipple","",1,"button","btn-ok",3,"disabled","matRippleDisabled","click"],[3,"items","title","itemsChange"],[1,"item"],[1,"error"]],template:function(r,o){1&r&&(t.DNE(0,M,1,3,"app-order-category",0),t.j41(1,"textarea",1),t.bIt("ngModelChange",function(l){return o.orderNotes=l}),t.k0s(),t.j41(2,"div",2)(3,"h2"),t.EFF(4,"Warenkorb"),t.k0s(),t.DNE(5,P,3,2,"div",3),t.DNE(6,E,2,1,"span",4),t.DNE(7,S,2,0,"span",5),t.j41(8,"button",6),t.bIt("click",function(){return o.order()}),t.EFF(9,"Bestellen "),t.k0s()()),2&r&&(t.Y8G("ngForOf",o.getCategoriesWithProducts()),t.R7$(1),t.Y8G("ngModel",o.orderNotes),t.R7$(4),t.Y8G("ngForOf",o.getSelectedProducts()),t.R7$(1),t.Y8G("ngIf",o.orderNotes&&o.orderNotes.length>0),t.R7$(1),t.Y8G("ngIf",0===o.getSelectedProducts().length&&!o.orderNotes),t.R7$(1),t.Y8G("disabled",0===o.getSelectedProducts().length&&!o.orderNotes)("matRippleDisabled",0===o.getSelectedProducts().length&&!o.orderNotes))},dependencies:[g.Sq,g.bT,C.r6,b.fg,h.me,h.BC,h.vS,y.A],styles:["textarea[_ngcontent-%COMP%]{width:70%;height:15%;resize:none;outline:none;margin:10% 15% 0;font-family:Roboto,Helvetica Neue,sans-serif;border:2px solid var(--table-accent);border-radius:5px;transition:border-color .15s ease-in-out;font-size:4vw}textarea[_ngcontent-%COMP%]:focus{border-color:var(--accent)}#cart-wrapper[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:0 20% 20%}#cart-wrapper[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}#cart-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin-top:3vh}#cart-wrapper[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{display:block;text-align:center}"]})}}return s})();var G=n(1801),R=n(8834),$=n(5553);const D=[{path:"",component:T}];let X=(()=>{class s{static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[g.MD,m.iI.forChild(D),G.m_,C.pZ,R.Hl,b.fS,h.YN,f._T,$.h]})}}return s})()}}]);